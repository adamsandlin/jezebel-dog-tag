<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Jezebel â€“ Dog Info</title>

  <style>
    :root {
      --bg:#ffffff; --text:#111; --card:#f2f2f2;
      --wa:#25D366; --wa-dark:#1B8F4B;
      --alex:#007AFF; --alex-dark:#0051A8;
      --emergency:#E53935;
    }
    @media (prefers-color-scheme: dark) {
      :root { --bg:#121212; --text:#f5f5f5; --card:#1f1f1f; }
    }
    body {
      font-family: system-ui, -apple-system, sans-serif;
      background: var(--bg);
      color: var(--text);
      padding: 20px;
      max-width: 520px;
      margin: auto;
    }
    .card { background: var(--card); padding: 16px; border-radius: 14px; }
    h1 { margin-top: 0; }
    button {
      width: 100%; padding: 14px; margin-top: 12px;
      border: none; border-radius: 12px;
      font-size: 16px; cursor: pointer;
      display: flex; align-items: center; justify-content: center; gap: 10px;
    }
    .wa { color: #fff; }
    .call { color: #fff; }
    .adam.wa { background: var(--wa); }
    .adam.call { background: var(--wa-dark); }
    .alex.wa { background: var(--alex); }
    .alex.call { background: var(--alex-dark); }
    .emergency { background: var(--emergency); color: #fff; font-weight: 700; }
    .wa { color: #fff; }
    .call { color: #fff; }
    .adam.wa { background: #25D366; }
    .adam.call { background: #1B8F4B; }
    .alex.wa { background: #007AFF; }
    .alex.call { background: #0051A8; }
    .wa { background: var(--btn); color: #fff; }
    .call { background: #007AFF; color: #fff; }
  </style>
</head>
<body>

<h1 id="title"></h1>
<p id="intro"></p>

<img src="jezebel.jpg" alt="Jezebel" style="width:100%;border-radius:12px;margin-bottom:12px" />

<div class="card" id="info"></div>

<button class="emergency" onclick="emergencyCall()" id="emergencyBtn"></button>

<button class="wa adam" onclick="sendWhatsApp('adam')" id="waAdam"></button>
<button class="call adam" onclick="callPerson('adam')" id="callAdam"></button>
<button class="wa alex" onclick="sendWhatsApp('alex')" id="waAlex"></button>
<button class="call alex" onclick="callPerson('alex')" id="callAlex"></button>

<script>
/* =====================
   CONFIG
===================== */
const NAME_ADAM = "Adam";
const NAME_ALEX = "Alex";
const PHONE_ADAM = "34607067359";
const PHONE_ALEX = "16193012756";
const GITHUB_USER = "adamsandlin";
const GITHUB_REPO = "jezebel-dog-tag";
const GITHUB_TOKEN = "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"; 

/* =====================
   AGE CALCULATION
===================== */
function calcAge() {
  const birth = new Date('2023-11-01');
  const now = new Date();
  const years = (now - birth) / (1000*60*60*24*365.25);
  return Math.round(years * 2) / 2 + " years";
}

/* =====================
   LANGUAGE DETECTION
===================== */
const lang = navigator.language.toLowerCase();
const L = lang.startsWith('es') ? 'es' : lang.startsWith('ca') ? 'ca' : 'en';

const T = {
  en: {
    title: "ğŸ¶ Hi, it seems like you found our dog, Jezebel!",
    intro: "Some important information about her is below, including how to contact us if you think that she is lost.",
    waAdam: "ğŸ’¬ WhatsApp Adam",
    callAdam: "ğŸ“ Call Adam",
    waAlex: "ğŸ’¬ WhatsApp Alex",
    callAlex: "ğŸ“ Call Alex",
    emergency: "ğŸš¨ EMERGENCY â€“ Dog found nearby",
    emergencyConfirm: "Use this only if you can see or are holding Jezebel right now. Continue?",
    msg: "Adam & Alex, I found Jezebel and I think she may be lost."
  },
  es: {
    title: "ğŸ¶ Parece que has encontrado a nuestra perra, Jezebel",
    intro: "A continuaciÃ³n encontrarÃ¡ informaciÃ³n importante sobre ella, incluido cÃ³mo comunicarse con nosotros si cree que estÃ¡ perdida.",
    waAdam: "ğŸ’¬ WhatsApp Adam",
    callAdam: "ğŸ“ Llamar a Adam",
    waAlex: "ğŸ’¬ WhatsApp Alex",
    callAlex: "ğŸ“ Llamar a Alex",
    emergency: "ğŸš¨ EMERGENCIA â€“ Perra encontrada cerca",
    emergencyConfirm: "Usa esto solo si puedes ver o sujetar a Jezebel ahora mismo. Â¿Continuar?",
    msg: "Adam y Alex, he encontrado a Jezebel y creo que puede estar perdida."
  },
  ca: {
    title: "ğŸ¶ Sembla que has trobat la nostra gossa, Jezebel",
    intro: "A continuaciÃ³ trobareu informaciÃ³ important sobre ella, inclosa com contactar amb nosaltres si creieu que s'ha perdut.",
    waAdam: "ğŸ’¬ WhatsApp Adam",
    callAdam: "ğŸ“ Trucar a Adam",
    waAlex: "ğŸ’¬ WhatsApp Alex",
    callAlex: "ğŸ“ Trucar a Alex",
    emergency: "ğŸš¨ EMERGÃˆNCIA â€“ Gos trobada a prop",
    emergencyConfirm: "Fes servir aixÃ² nomÃ©s si pots veure o subjectar la Jezebel ara mateix. Continuar?",
    msg: "Adam i Alex, he trobat la Jezebel i crec que pot estar perduda."
  }
};

/* =====================
   RENDER PAGE
===================== */
document.getElementById('title').innerText = T[L].title;
document.getElementById('intro').innerText = T[L].intro;
document.getElementById('emergencyBtn').innerText = T[L].emergency;
document.getElementById('waAdam').innerText = T[L].waAdam;
document.getElementById('callAdam').innerText = T[L].callAdam;
document.getElementById('waAlex').innerText = T[L].waAlex;
document.getElementById('callAlex').innerText = T[L].callAlex;
 `${T[L].alex}`;

document.getElementById('info').innerHTML = `
<p>ğŸ¶ Name: Jezebel</p>
<p>ğŸšº Sex: Female</p>
<p>ğŸ• Breed: Australian Cattle Dog Mix</p>
<p>ğŸ‚ Age: ${calcAge()}</p>
<p>âš–ï¸ Weight: 13 kg</p>
<p>ğŸ¥ Spayed: Yes</p>
<p>ğŸ’‰ Vaccinated: Yes</p>
<p>ğŸ›œ Microchipped: Yes</p>
<p>ğŸ©º Allergies: Chicken</p>
<p>ğŸ˜‡ Temperament: Very friendly, anxious with traffic and loud noise</p>
<p>ğŸ  Home city: Barcelona</p>
<p>ğŸ“ Owners: Adam & Alex</p>`;

/* =====================
   GITHUB LOGGING
===================== */
function logScan(locationText = "Location not shared") {
  fetch(`https://api.github.com/repos/${GITHUB_USER}/${GITHUB_REPO}/dispatches`, {
    method: "POST",
    headers: {
      "Accept": "application/vnd.github+json",
      "Authorization": `Bearer ${GITHUB_TOKEN}`,
      "Content-Type": "application/json"
    },
    body: JSON.stringify({
      event_type: "nfc_scan",
      client_payload: {
        date: new Date().toISOString(),
        language: navigator.language,
        userAgent: navigator.userAgent,
        location: locationText
      }
    })
  });
}

navigator.geolocation.getCurrentPosition(
  pos => logScan(`Lat: ${pos.coords.latitude}, Lon: ${pos.coords.longitude}`),
  () => logScan()
);

/* =====================
   WHATSAPP
===================== */
function sendWhatsApp(who) {
  const name = name === 'Adam' ? NAME_ADAM : NAME_ALEX;
  const baseEN = T['en'].msg;
  const baseLocal = T[L].msg;
  const num = who === 'adam' ? PHONE_ADAM : PHONE_ALEX;

  navigator.geolocation.getCurrentPosition(pos => {
    const map = `https://maps.google.com/?q=${pos.coords.latitude},${pos.coords.longitude}`;
    const time = new Date().toLocaleString();
    openWA(num, `${baseLocal}
${baseEN}

${map}
${time}

Hi ${name}, I found Jezebel and think she is lost.

(Please add any additional details that will help us locate Jezebel, and thank you for keeping her safe!)`);
  }, () => {
    openWA(num, `${baseLocal}
${baseEN}

Hi ${name}, I found Jezebel and think she is lost.

(Please add any additional details that will help us locate Jezebel, and thank you for keeping her safe!)`);
  });
}

function openWA(num, text) {
  window.location.href = `https://wa.me/${num}?text=${encodeURIComponent(text)}`;
}

function emergencyCall() {
  if (!confirm(T[L].emergencyConfirm)) return;

  navigator.geolocation.getCurrentPosition(pos => {
    const map = `https://maps.google.com/?q=${pos.coords.latitude},${pos.coords.longitude}`;
    const time = new Date().toLocaleString();

    logScan(`EMERGENCY â€“ ${map}`);

    window.location.href = `tel:+${PHONE_ADAM}`;

    setTimeout(() => {
      openWA(PHONE_ADAM,
        `ğŸš¨ EMERGENCY
${T[L].msg}

${map}
${time}`
      );
    }, 4000);
  }, () => {
    logScan("EMERGENCY â€“ location denied");
    window.location.href = `tel:+${PHONE_ADAM}`;
  });
}

function callPerson(text) {
  window.location.href = `https://wa.me/?text=${encodeURIComponent(text)}`;
}

/* =====================
   CALLING
===================== */
function callPerson(who) {
  const num = who === 'adam' ? PHONE_ADAM : PHONE_ALEX;
  if (confirm('Call via WhatsApp?')) {
    window.location.href = `https://wa.me/${num}`;
  } else {
    window.location.href = `tel:+${num}`;
  }
}
</script>
</body>
</html>
