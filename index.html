<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Jezebel ‚Äì Dog Info</title>

  <style>
    :root {
      --bg:#ffffff; --text:#111; --card:#f2f2f2; --btn:#25D366;
    }
    @media (prefers-color-scheme: dark) {
      :root { --bg:#121212; --text:#f5f5f5; --card:#1f1f1f; }
    }
    body {
      font-family: system-ui, -apple-system, sans-serif;
      background: var(--bg);
      color: var(--text);
      padding: 20px;
      max-width: 520px;
      margin: auto;
    }
    .card { background: var(--card); padding: 16px; border-radius: 14px; }
    h1 { margin-top: 0; }
    button {
      width: 100%; padding: 14px; margin-top: 12px;
      border: none; border-radius: 10px;
      font-size: 16px; cursor: pointer;
    }
    .wa { background: var(--btn); color: #fff; }
    .call { background: #007AFF; color: #fff; }
  </style>
</head>
<body>

<h1 id="title"></h1>
<p id="intro"></p>

<img src="jezebel.jpg" alt="Jezebel" style="width:100%;border-radius:12px;margin-bottom:12px" />

<div class="card" id="info"></div>

<button class="wa" onclick="sendWhatsApp()" id="waBtn"></button>
<button class="call" onclick="callPerson('adam')" id="adamBtn"></button>
<button class="call" onclick="callPerson('alex')" id="alexBtn"></button>

<script>
/* =====================
   CONFIG
===================== */
const PHONE_ADAM = "+34607067359";
const PHONE_ALEX = "+16193012756";
const GITHUB_USER = "adamsandlin";
const GITHUB_REPO = "jezebel-dog-tag";
const GITHUB_TOKEN = "* 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"; 

/* =====================
   AGE CALCULATION
===================== */
function calcAge() {
  const birth = new Date('2023-11-01');
  const now = new Date();
  const years = (now - birth) / (1000*60*60*24*365.25);
  return Math.round(years * 2) / 2 + " years";
}

/* =====================
   LANGUAGE DETECTION
===================== */
const lang = navigator.language.toLowerCase();
const L = lang.startsWith('es') ? 'es' : lang.startsWith('ca') ? 'ca' : 'en';

const T = {
  en: {
    title: "üê∂ Hi, it seems like you found our dog, Jezebel!",
    intro: "Some important information about her is below, including how to contact us if you think that she is lost.",
    wa: "Send us a WhatsApp message",
    adam: "Call Adam",
    alex: "Call Alex",
    msg: "Adam & Alex, I found Jezebel and I think she may be lost."
  },
  es: {
    title: "üê∂ Parece que has encontrado a nuestra perra, Jezebel",
    intro: "A continuaci√≥n encontrar√° informaci√≥n importante sobre ella, incluido c√≥mo comunicarse con nosotros si cree que est√° perdida.",
    wa: "Enviar WhatsApp",
    adam: "Llamar a Adam",
    alex: "Llamar a Alex",
    msg: "Adam y Alex, he encontrado a Jezebel y creo que puede estar perdida."
  },
  ca: {
    title: "üê∂ Sembla que has trobat la nostra gossa, Jezebel",
    intro: "A continuaci√≥ trobareu informaci√≥ important sobre ella, inclosa com contactar amb nosaltres si creieu que s'ha perdut.",
    wa: "Enviar WhatsApp",
    adam: "Trucar a Adam",
    alex: "Trucar a Alex",
    msg: "Adam i Alex, he trobat la Jezebel i crec que pot estar perduda."
  }
};

/* =====================
   RENDER PAGE
===================== */
document.getElementById('title').innerText = T[L].title;
document.getElementById('intro').innerText = T[L].intro;
document.getElementById('waBtn').innerText = T[L].wa;
document.getElementById('adamBtn').innerText = T[L].adam;
document.getElementById('alexBtn').innerText = T[L].alex;

document.getElementById('info').innerHTML = `
<p>üê∂ Name: Jezebel</p>
<p>üö∫ Sex: Female</p>
<p>üêï Breed: Australian Cattle Dog Mix</p>
<p>üéÇ Age: ${calcAge()}</p>
<p>‚öñÔ∏è Weight: 13 kg</p>
<p>üè• Spayed: Yes</p>
<p>üíâ Vaccinated: Yes</p>
<p>üõú Microchipped: Yes</p>
<p>ü©∫ Allergies: Chicken</p>
<p>üòá Temperament: Very friendly, anxious with traffic and loud noise</p>
<p>üè† Home city: Barcelona</p>
<p>üìû Owners: Adam & Alex</p>`;

/* =====================
   GITHUB LOGGING
===================== */
function logScan(locationText = "Location not shared") {
  fetch(`https://api.github.com/repos/${GITHUB_USER}/${GITHUB_REPO}/dispatches`, {
    method: "POST",
    headers: {
      "Accept": "application/vnd.github+json",
      "Authorization": `Bearer ${GITHUB_TOKEN}`,
      "Content-Type": "application/json"
    },
    body: JSON.stringify({
      event_type: "nfc_scan",
      client_payload: {
        date: new Date().toISOString(),
        language: navigator.language,
        userAgent: navigator.userAgent,
        location: locationText
      }
    })
  });
}

navigator.geolocation.getCurrentPosition(
  pos => logScan(`Lat: ${pos.coords.latitude}, Lon: ${pos.coords.longitude}`),
  () => logScan()
);

/* =====================
   WHATSAPP
===================== */
function sendWhatsApp() {
  const baseEN = T['en'].msg;
  const baseLocal = T[L].msg;

  navigator.geolocation.getCurrentPosition(pos => {
    const map = `https://maps.google.com/?q=${pos.coords.latitude},${pos.coords.longitude}`;
    const time = new Date().toLocaleString();
    openWA(`${baseLocal}
${baseEN}

${map}
${time}

(Please add any additional details that will help us locate Jezebel, and thank you for keeping her safe!)`);
  }, () => {
    openWA(`${baseLocal}
${baseEN}

(Please add any additional details that will help us locate Jezebel, and thank you for keeping her safe!)`);
  });
}

function openWA(text) {
  window.location.href = `https://wa.me/?text=${encodeURIComponent(text)}`;
}

/* =====================
   CALLING
===================== */
function callPerson(who) {
  const num = who === 'adam' ? PHONE_ADAM : PHONE_ALEX;
  if (confirm('Call via WhatsApp?')) {
    window.location.href = `https://wa.me/${num}`;
  } else {
    window.location.href = `tel:+${num}`;
  }
}
</script>
</body>
</html>
